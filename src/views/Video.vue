<!--suppress ES6ModulesDependencies, JSUnresolvedVariable -->
<template>
  <div>
    <v-parallax height="300" :src="headerImage" style="background: #202020">
      <v-layout fill-height align-center column justify-center>
        <router-link
          tag="h1"
          :to="`/${$route.params.streamer}`"
          class="display-3 font-weight-thin mb-1 text-uppercase pointer link"
        >
          {{ $route.params.streamer }}
        </router-link>
        <router-link tag="h4" to="/" class="title font-weight-bold text-uppercase pointer link">
          StreamArchive
        </router-link>
      </v-layout>
    </v-parallax>
    <v-container fluid grid-list-md>
      <v-layout wrap>
        <v-flex xs12 md9 class="mb-4">
          <v-img :aspect-ratio="16 / 9">
            <v-layout column fill-height>
              <video-player @info="updateInfo" @copied="updateInfo" />
            </v-layout>
          </v-img>

          <v-layout>
            <v-flex xs4><v-text-field type="number" min="0" v-model="start"/></v-flex>
            <v-flex xs4><v-text-field type="number" :min="start" :max="stream.duration" v-model="end"/></v-flex>
            <v-flex xs4>
              <v-btn :disabled="end - start > 120 || end < 0 || start < 0" flat fab @click="openClip()">
                <v-icon>{{ clip ? "replay" : "movie_creation" }}</v-icon>
              </v-btn>
              <v-btn v-if="clip" flat fab @click="closeClip()">
                <v-icon>clear</v-icon>
              </v-btn>
            </v-flex>
          </v-layout>

          <v-img :aspect-ratio="16 / 9" v-if="clip">
            <v-layout column fill-height>
              <clips-player :start="+start" :end="+end" />
            </v-layout>
          </v-img>
        </v-flex>
        <v-flex xs12 md3 class="mb-4">
          <v-layout wrap>
            <v-flex xs8 md12 class="title">{{ stream.title }}</v-flex>
            <v-flex xs4 md12 class="subtitle-2 font-italic text-xs-right text-md-left">{{ stream.game }}</v-flex>
            <v-flex xs12 md12 class="subtitle-1">{{ dateString }}</v-flex>
          </v-layout>
        </v-flex>
      </v-layout>
    </v-container>
  </div>
</template>
<script>
import VideoPlayer from "@/components/VideoPlayer";
import ClipsPlayer from "@/components/ClipPlayer";
export default {
  components: { ClipsPlayer, VideoPlayer },
  data() {
    return {
      stream: {},
      start: 0,
      end: 10,
      clip: false
    };
  },
  computed: {
    dateString() {
      let months = ["янв", "фев", "мар", "апр", "мая", "июн", "июл", "авг", "сен", "окт", "ноя", "дек"];
      if (!this.stream.date) return;
      let [day, index, year] = this.stream.date
        .split("T")[0]
        .split("-")
        .reverse();
      return day + " " + months[index - 1] + " " + year;
    },
    headerImage() {
      try {
        return require("@/assets/" + this.$route.params.streamer + ".jpg");
      } catch (e) {
        return null;
      }
    }
  },
  methods: {
    updateInfo(info) {
      this.stream = info;
      document.title =
        info.title +
        " | " +
        this.$route.params.streamer.toUpperCase() +
        " | StreamArchive - ЛУЧШИЙ АРХИВ ВО ВСЕЛЕННОЙ КСТА";
    },
    openClip() {
      this.clip = false;
      this.clip = true;
    },
    closeClip() {
      this.clip = false;
    }
  }
};
</script>
